// Generated by CoffeeScript 1.4.0
(function() {
  var checkUser, checkuserHandler, formInputChanged, formSubmit, isFormValid, showCheckUserAlert, usernameInputChanged;

  checkUser = function() {
    var username;
    $('#divAlertsContainer').children().hide();
    $('#btnUsernameCheck').button('loading');
    username = $('#id_username').val();
    return $.ajax("/api/user/" + username + "/?format=json", {
      success: checkuserHandler
    });
  };

  checkuserHandler = function(data, status, xhr) {
    $('#btnUsernameCheck').button('reset');
    return showCheckUserAlert(data.exists);
  };

  showCheckUserAlert = function(userExists) {
    var alertbox, username_input;
    username_input = $('#id_username').parent();
    if (userExists) {
      alertbox = $('#spAlertUserExists');
      username_input.addClass('has-success');
    } else {
      alertbox = $('#spAlertUserNotExists');
      username_input.addClass('has-error');
    }
    return alertbox.fadeIn(function() {
      var delay,
        _this = this;
      return setTimeout((function() {
        return alertbox.fadeOut();
      }), delay = 1000);
    });
  };

  usernameInputChanged = function() {
    var disabled, val;
    val = $('#id_username').val();
    if (val) {
      disabled = false;
    } else {
      disabled = true;
    }
    $('#btnUsernameCheck').prop('disabled', disabled);
    $('#id_username').parent().removeClass('has-error').removeClass('has-success');
    return $('#divAlertsContainer').children().hide();
  };

  formInputChanged = function() {
    return $('#submit-id-verify').prop('disabled', !isFormValid());
  };

  isFormValid = function() {
    if (!$('#id_username').val()) {
      return false;
    }
    if ($.grep($('[name=usertype]'), function(item) {
      return $(item).is(':checked');
    }).length === 0) {
      return false;
    }
    return true;
  };

  formSubmit = function() {
    return $('#verificationForm :input[type=submit]').button('loading');
  };

  $(document).ready(function() {
    console.log('Document loaded');
    $('#btnUsernameCheck').click(checkUser);
    $('#id_username').on('input', usernameInputChanged);
    $('#divAlertsContainer').children().hide();
    usernameInputChanged();
    $('#verificationForm :input').on('input', formInputChanged);
    $('#verificationForm :input[type=radio]').change(formInputChanged);
    $('#verificationForm').submit(formSubmit);
    return window.setTimeout((function() {
      return $('#verificationSuccessAlert').fadeOut();
    }), 2000);
  });

}).call(this);
